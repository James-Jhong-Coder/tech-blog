---
title: "HTML Canvas çš„ä½¿ç”¨æ–¹å¼"
description: "HTML Canvas çš„ç›¸é—œç­†è¨˜"
createDate: 2025-12-23
category: tech
draft: false
tags: ["TypeScript", "JavaScript", "Canvas"]
---


## ä»€éº¼æ˜¯ Canvas

Canvas æ˜¯å¯ä»¥è®“ä½ ç”¨ç¨‹å¼ç›´æ¥åœ¨ç¶²é ä¸Šç•«åœ–çš„å·¥å…·

ä»–æ˜¯ä¸€å¼µç©ºç™½ç•«å¸ƒï¼Œå¯ä»¥åœ¨ä¸Šé¢ç•«åœ–å½¢ã€å‹•ç•«ã€æˆ–æ˜¯ç‰¹æ•ˆ

é‚£ä¸»è¦æ˜¯é€é JavaScript å‘Šè¨´ç€è¦½å™¨è¦ç•«å‡ºé»ã€ç·šã€é¢

æ‰€ä»¥ Canvas å¾ˆé©åˆç”¨ä¾†åšç¹ªåœ–æˆ–å‹•ç•«

## æ€éº¼åˆå§‹åŒ–

è¦åˆå§‹åŒ– Canvas å°±æ˜¯å…ˆæ‹¿åˆ° canvas çš„ domï¼Œç„¶å¾Œå†å–å¾—

1. é¦–å…ˆè¦åœ¨ HTML æ”¾ä¸€å€‹ canvas

```html
<canvas id="myCanvas"></canvas>
```

2. ç„¶å¾Œé€é JavaScript å–å¾— Canvas DOM

```js
<canvas id="myCanvas"></canvas>;
const canvas = document.getElementById("myCanvas");
```

3. è¨­å®šç•«å¸ƒå¤§å°
   ä¸å»ºè­°åªç”¨ CSS è¨­å®šå¯¬é«˜ï¼Œæœƒé€ æˆç•«é¢ç³Šæ‰

```js
canvas.width = 300;
canvas.height = 150;
```

4. å–å¾— 2D ç¹ªåœ–ç’°å¢ƒï¼ˆåˆå§‹åŒ–å®Œæˆï¼‰

```js
const ctx = canvas.getContext("2d");
```

### Vue3 ç’°å¢ƒç¨‹å¼ç¢¼

```vue
<script setup>
import { ref, onMounted } from "vue";

const canvasRef = ref(null);

onMounted(() => {
  const canvas = canvasRef.value;
  canvas.width = 300;
  canvas.height = 150;

  const ctx = canvas.getContext("2d");
  ctx.fillRect(20, 20, 50, 50);
});
</script>

<template>
  <canvas ref="canvasRef"></canvas>
</template>
```

## ç•«ç·šæ¢

å–å¾— canvas context ä¹‹å¾Œå°±å¯ä»¥é–‹å§‹ç•«ç·šæ¢

```js
ctx.strokeStyle = "red";
ctx.lineWidth = 4;

ctx.beginPath();
ctx.moveTo(10, 10);
ctx.lineTo(100, 100);
ctx.stroke();
```

ä»¥ä¸‹æ˜¯ context çš„ä¸€äº›è¨­å®š

### lineCap

lineCap åªä½œç”¨åœ¨ä½ ç•«ç·šæ™‚çš„ èµ·é»èˆ‡çµ‚é»ï¼Œ

ä¾‹å¦‚å…©æ¢ç·šäº¤æœƒæ™‚ï¼Œç«¯é»çœ‹èµ·ä¾†æœƒä¸æœƒã€Œæ–·é–‹ã€æˆ–ã€Œåœ“æ»‘ã€ï¼Œå°±å–æ±ºæ–¼å®ƒã€‚

æœ‰ä¸‰å€‹å±¬æ€§å¯ä»¥è¨­å®š

1. buttï¼ˆé è¨­ï¼‰ï¼šç«¯é»ç›´æ¥åˆ‡é½Šåº§æ¨™é»ï¼Œçœ‹èµ·ä¾†æ¯”è¼ƒéŠ³åˆ©
2. roundï¼šç«¯é»æ˜¯åœ“å¼§ï¼Œç·šæ¢æ¥èµ·ä¾†æœƒæ¯”è¼ƒè‡ªç„¶
3. squareï¼šç«¯é»æœƒè¶…å‡ºä¸€é»é»ï¼Œè¦–è¦ºä¸Šæ¯”è¼ƒåšå¯¦

```js
ctx.lineWidth = 10;

// é è¨­ï¼šbutt
ctx.lineCap = "butt";
ctx.beginPath();
ctx.moveTo(20, 20);
ctx.lineTo(120, 20);
ctx.stroke();

// åœ“è§’
ctx.lineCap = "round";
ctx.beginPath();
ctx.moveTo(20, 50);
ctx.lineTo(120, 50);
ctx.stroke();

// æ–¹è§’
ctx.lineCap = "square";
ctx.beginPath();
ctx.moveTo(20, 80);
ctx.lineTo(120, 80);
ctx.stroke();
```

### lineJoin

lineJoin ç”¨ä¾†æ±ºå®šã€Œç·šèˆ‡ç·šè½‰å½æ™‚ï¼Œè§’è½è¦æ€éº¼æ¥ã€ã€‚

1. ç•¶ä½ ç•«æŠ˜ç·šã€å¤šé‚Šå½¢ï¼ˆä¾‹å¦‚æ­£æ–¹å½¢ã€ç®­é ­ï¼‰ï¼Œæ¯å€‹ã€Œæ‹å½çš„è§’ã€è¦å°–ã€è¦åœ“ã€é‚„æ˜¯è¦è¢«å‰Šå¹³ï¼Œéƒ½æ˜¯ lineJoin åœ¨æ±ºå®šã€‚
2. Canvas æœ‰ä¸‰ç¨®è½‰è§’æ¨£å¼
   - miterï¼ˆé è¨­ï¼‰ï¼šå°–è§’ï¼Œå»¶ä¼¸äº¤æœƒï¼ˆè§’åº¦å¤ªå°æœƒè®Šå¾ˆå°–ï¼‰
   - roundï¼šåœ“è§’ï¼Œæœ€è‡ªç„¶ã€æœ€ä¸å®¹æ˜“å‡ºç¾é‹¸é½’
   - bevelï¼šæ–œåˆ‡è§’ï¼ŒæŠŠå°–è§’å‰Šæ‰ä¸€å¡Š

```js
// 1) butt
ctx.lineCap = "butt";
ctx.beginPath();
ctx.moveTo(x1, h * 0.28);
ctx.lineTo(x2, h * 0.28);
ctx.stroke();

// 2) round
ctx.lineCap = "round";
ctx.beginPath();
ctx.moveTo(x1, h * 0.5);
ctx.lineTo(x2, h * 0.5);
ctx.stroke();

// 3) square
ctx.lineCap = "square";
ctx.beginPath();
ctx.moveTo(x1, h * 0.72);
ctx.lineTo(x2, h * 0.72);
ctx.stroke();
```

### shadow

canvas ç•«ç·šæ®µæ™‚å¯ä»¥åŠ ä¸Šé™°å½±

åŸºæœ¬ä¸Šå°±æ˜¯é€™å¹¾å€‹å±¬æ€§å¯ä»¥è¨­å®š

å°±è·Ÿ CSS ä¸€æ¨£å¯ä»¥è¨­å®šé¡è‰²ã€blur çš„ç¨‹åº¦ã€é™°å½± x y è»¸åç§»é‡

```js
ctx.shadowColor = "rgba(0,0,0,0.6)";
ctx.shadowBlur = 12;
ctx.shadowOffsetX = 0;
ctx.shadowOffsetY = 6;
```

```vue
<script setup lang="ts">
import { onMounted, ref } from "vue";

const canvas = ref<HTMLCanvasElement | null>(null);

onMounted(() => {
  const el = canvas.value;
  if (!el) return;

  const ctx = el.getContext("2d");
  if (!ctx) return;

  // è¨­å®šç•«å¸ƒå¤§å°ï¼ˆé¿å…é è¨­ 300x150ï¼‰
  el.width = 400;
  el.height = 200;

  // é™°å½±è¨­å®š
  ctx.shadowColor = "rgba(0, 0, 0, 0.6)";
  ctx.shadowBlur = 20;
  ctx.shadowOffsetX = 0;
  ctx.shadowOffsetY = 5;

  // ç·šæ¢è¨­å®š
  ctx.strokeStyle = "red";
  ctx.lineWidth = 12;
  ctx.lineCap = "round";

  // ç•«ä¸€æ¢ç·š
  ctx.beginPath();
  ctx.moveTo(50, 100);
  ctx.lineTo(350, 100);
  ctx.stroke();
});
</script>

<template>
  <canvas ref="canvas" />
</template>

<style scoped>
canvas {
  background: white;
}
</style>
```

## ç•«çŸ©å½¢

ç•« rect åƒæ•¸æœ‰å››å€‹

1. x
2. y
3. å¯¬åº¦
4. é«˜åº¦

ç„¶å¾Œè¦åœ¨ç”¨ ctx.stroke(); å»æé‚Š

```js
  const canvas = canvasRef.value!;
  const ctx = canvas.getContext("2d")!;

  ctx.lineWidth = 4;
  ctx.strokeStyle = "#333";

  ctx.beginPath();
  ctx.rect(
    50,   // x
    50,   // y
    200,  // width
    120   // height
  );
  ctx.stroke();
```

## ç•«åœ“å½¢

é€™é‚Šæ˜¯ç”¨ arc å»ç•«ï¼Œç„¶å¾Œä»–æ˜¯å¾ 0 ç•«åˆ° 360 åº¦

```js
<script setup lang="ts">
import { ref, onMounted } from "vue";

const canvasRef = ref<HTMLCanvasElement | null>(null);

onMounted(() => {
  const canvas = canvasRef.value!;
  const ctx = canvas.getContext("2d")!;

  ctx.lineWidth = 4;
  ctx.strokeStyle = "#333";

  ctx.beginPath();
  ctx.arc(
    150,               // åœ“å¿ƒ x
    100,               // åœ“å¿ƒ y
    60,                // åŠå¾‘
    0,                 // èµ·å§‹è§’åº¦
    Math.PI * 2        // çµæŸè§’åº¦ï¼ˆæ•´åœˆï¼‰
  );
  ctx.stroke();
});
</script>

<template>
  <canvas ref="canvasRef" width="300" height="200" />
</template>
```

## ç•«å‡ºæ–‡å­—

- ctx.textAlign = "left"; æœ‰ä¸‰å€‹å±¬æ€§

  - left æ–‡å­—å¾ x å¾€å³ç•«
  - center æ–‡å­—ä¸­å¿ƒåœ¨ x
  - right æ–‡å­—çµå°¾åœ¨ x

- ctx.textBaseline é€™æ˜¯ y åº§æ¨™è¦å°é½Šæ–‡å­—çš„å“ªä¸€å€‹ã€ŒåŸºæº–ç·šã€è¨­å®š
  - alphabetic
  - top
  - middle
  - bottom
  - hanging
  - ideographic

```vue
<script setup lang="ts">
import { ref, onMounted } from "vue";

const canvasRef = ref<HTMLCanvasElement | null>(null);

onMounted(() => {
  const canvas = canvasRef.value!;
  const ctx = canvas.getContext("2d")!;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#333";
  ctx.font = "24px Arial";
  ctx.textAlign = "left"; // left | center | right
  ctx.textBaseline = "middle"; // top | middle | bottom

  ctx.fillText("Hello Canvas", canvas.width / 2, canvas.height / 2);
});
</script>

<template>
  <canvas ref="canvasRef" width="300" height="200" class="x" />
</template>

<style scoped>
.x {
  background: white;
}
</style>
```

æ–‡å­—ä¹Ÿå¯ä»¥åŠ ä¸Šé™°å½±

```js
ctx.shadowColor = "rgba(0, 0, 0, 0.5)";
ctx.shadowBlur = 10;
ctx.shadowOffsetX = 4;
ctx.shadowOffsetY = 4;
```


## åœ¨ canvas ä¸Šç¹ªè£½åœ–ç‰‡

åœ¨ canvas ä¸Šç¹ªè£½åœ–ç‰‡å¯ä»¥ç”¨ drawImage é€™å€‹æ–¹æ³•

æ ¹æ“šçµ¦å®šçš„åƒæ•¸å¯ä»¥åšåˆ°æ˜¯å¦ç¸®æ”¾æˆ–æ˜¯è£åˆ‡ä¾†æºåœ–ç‰‡

### drawImage(img, dx, dy)

ä»–çš„ç”¨é€”æ˜¯ç›´æ¥æŠŠæ•´å¼µåœ–ç‰‡ç•«åˆ° canvas æŒ‡å®šä½ç½®ï¼Œä¸åšä»»ä½•ç¸®æ”¾æˆ–è£åˆ‡ã€‚

åƒæ•¸èªªæ˜
* imgï¼šImage / HTMLImageElement / Canvas / Video
* dxï¼šç›®æ¨™ X åº§æ¨™ï¼ˆcanvasï¼‰
* dyï¼šç›®æ¨™ Y åº§æ¨™ï¼ˆcanvasï¼‰

è¡Œç‚ºç‰¹æ€§
* ä½¿ç”¨åœ–ç‰‡çš„ã€ŒåŸå§‹å¯¬é«˜ã€
* å·¦ä¸Šè§’å°é½Š (dx, dy)
* æœ€å–®ç´”ã€æ•ˆèƒ½æœ€å¥½

![ç¶²é æ¸²æŸ“æ­¥é©Ÿ](/images/canvas-draw-image-1.png)

```js
ctx.drawImage(img, 50, 30);
```

### drawImage(img, dx, dy, dw, dh)

ç”¨é€”æ˜¯æŠŠæ•´å¼µåœ–ç‰‡ç•«åˆ° canvasï¼Œä¸¦æŒ‡å®šç›®æ¨™å¯¬é«˜ï¼ˆç¸®æ”¾ï¼‰ã€‚

åƒæ•¸èªªæ˜
* dwï¼šç›®æ¨™å¯¬åº¦ï¼ˆdestination widthï¼‰
* dhï¼šç›®æ¨™é«˜åº¦ï¼ˆdestination heightï¼‰

è¡Œç‚ºç‰¹æ€§
* ä¾†æºä»æ˜¯ã€Œæ•´å¼µåœ–ç‰‡ã€
* æœƒä¾ dw / dh é€²è¡Œç¸®æ”¾
* è‹¥æ¯”ä¾‹ä¸åŒï¼Œåœ–ç‰‡æœƒè¢«æ‹‰ä¼¸æˆ–å£“ç¸®

```js
ctx.drawImage(img, 50, 30, 200, 100);
```

### drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh)

å¾åœ–ç‰‡ã€Œè£åˆ‡ä¸€å¡Šå€åŸŸã€ï¼Œå†ç•«åˆ° canvas æŒ‡å®šä½ç½®èˆ‡å¤§å°ã€‚

ğŸ“Œ ä¾†æºåœ–ç‰‡ï¼ˆsourceï¼‰
* sx, syï¼šå¾åœ–ç‰‡å“ªå€‹åº§æ¨™é–‹å§‹è£
* sw, shï¼šè£åˆ‡å¯¬é«˜

ğŸ“Œ ç›®æ¨™ç•«å¸ƒï¼ˆdestinationï¼‰
* dx, dyï¼šç•«åˆ° canvas çš„ä½ç½®
* dw, dhï¼šç•«åˆ° canvas çš„å¤§å°ï¼ˆå¯ç¸®æ”¾ï¼‰