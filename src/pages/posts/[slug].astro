---
import { getCollection } from "astro:content";
import Layout from "@/layouts/Layout.astro";

export async function getStaticPaths() {
    const posts = await getCollection("posts", ({ data }) => !data.draft);
    return posts.map((post) => ({
        params: { slug: post.id },
    }));
}

const { slug } = Astro.params;
const post = (await getCollection("posts")).find((p) => p.id === slug);

if (!post) {
    throw new Error(`Post not found: ${slug}`);
}

const dateText = post.data.createDate
    ? new Date(post.data.createDate).toISOString().slice(0, 10)
    : "";
---

<Layout>
    <article class="prose max-w-none">
        <h1>{post.data.title}-1</h1>
        {dateText && <p class="text-gray-500">{dateText}</p>} - 2
        <div set:html={post.rendered.html} />
    </article>
</Layout>
