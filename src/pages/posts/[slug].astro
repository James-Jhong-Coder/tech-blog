---
import { getCollection, render } from "astro:content";
import dayjs from "dayjs";
import Layout from "@/layouts/Layout.astro";
import Breadcrumb from "@/components/Breadcrumb.astro";
import Prose from "@/components/Prose.astro";
import IconPostDate from "@/assets/icons/icon_post_date.svg";
import IconReadingTime from "@/assets/icons/icon_reading_time.svg";
import { getReadingTime } from "@/utils/readingTime";
export async function getStaticPaths() {
  const posts = await getCollection("posts", ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.id },
  }));
}

const { slug } = Astro.params;
const post = (await getCollection("posts")).find((p) => p.id === slug);

if (!post) {
  throw new Error(`Post not found: ${slug}`);
}
const readingTime = getReadingTime(post.body); // post.body = 文章全文
const { Content } = await render(post);
// const dateText = post.data.createDate
//     ? new Date(post.data.createDate).toISOString().slice(0, 10)
//     : "";
---

<Layout>
  {
    post.data.coverImage ? (
      <img
        src={post.data.coverImage}
        alt={post.data.title}
        class="w-full rounded-lg mt-6"
      />
    ) : null
  }

  <Breadcrumb
    class="mt-6 mb-10"
    items={[
      { label: "首頁", href: "/", iconName: "home" },
      { label: "文章列表", href: "/posts", iconName: "postList" },
      { label: post.id, href: "", iconName: "post" },
    ]}
  />
  <div class="post-meta mb-6">
    <div class="flex items-center">
      <IconPostDate class="w-3 h-3 mr-1" />
      <span>{dayjs(post.data.createDate).format("YYYY-MM-DD")}</span>
    </div>
    <div class="flex items-center ml-4">
      <IconReadingTime class="w-3 h-3 mr-1" />
      <span>{readingTime}</span>
    </div>
  </div>
  <Prose>
    <Content />
  </Prose>
</Layout>

<style>
  @reference "../../styles/global.css";
  .post-meta {
    @apply flex items-center;
    @apply text-gray-430 text-xs leading-none;
  }
</style>
